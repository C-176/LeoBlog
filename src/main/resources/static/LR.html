<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LeoBlog</title>
    <link href="css/LR.css" rel="stylesheet">
    <!--    <link href="css/index1.css" rel="stylesheet">-->
    <link href="css/daemon.css" rel="stylesheet">
    <link href="source/images/favicon.ico" rel="shortcut icon"/>
    
    <script src="js/sweetalert2.all.min.js"></script>
    <script src="js/sweetalert2.min.js"></script>

</head>
<body id="your-element-selector">
<script src="js/dynamicBg/three.r119.min.js"></script>
<script src="js/dynamicBg/vanta.globe.min.js"></script>
<script src="js/dynamicBg/vanta.rings.min.js"></script>
<script>
    
    // VANTA.GLOBE({
    //     el: "#your-element-selector",
    //     mouseControls: true,
    //     touchControls: true,
    //     gyroControls: false,
    //     minHeight: 600.00,
    //     minWidth: 200.00,
    //     scale: 1.00,
    //     scaleMobile: 1.00,
    //     color: 0x134857,
    //     color2: 0xfa0028,
    //     size: 0.80,
    //     backgroundColor: 0xd8e3e7
    // })
    VANTA.RINGS({
        el: "#your-element-selector",
        mouseControls: true,
        touchControls: true,
        gyroControls: false,
        minHeight: 600.00,
        minWidth: 200.00,
        scale: 0.60,
        scaleMobile: 1.00,
        backgroundColor: 0xd8e3e7,
        color: 0x134857
    })
</script>
<div class="login" style="    position: fixed;
    height: 40px;
    top: 0px;
    width: 70px;
    font-size: 20px;
    line-height: 40px;
    z-index: 2;
    border-radius: 5px;
    right: 20px;"><a id="mode" href="javascript:void(0)">注册</a></div>
<div class="header">
    <span class="iconfont">&#xe614;</span>
    <div id="cyber">LeoBlog</div>
</div>
<div class="main">
    <div class="right">
        <form action="javascript:void(0)" method="post">
            <h3>用户名/邮箱</h3>
            <label>
                <input autocomplete="off" autofocus name="userName" placeholder="" required type="text" value="a">
            </label>
            <h3>密码</h3>
            <label>
                <input autocomplete="new-password" name="userPassword" placeholder="" required type="password"
                       value="111">
            </label>
            <h3>记住密码</h3>
            <label>
                <input  name="rememberMe" placeholder="" required type="checkbox" value=0>
            </label>
            <button class="login1" name="mode" type="submit" value="login">登陆</button>
        </form>
    </div>

</div>
<div class="main" style="display: none">
    <div class="right" style="    padding-top: 0;">
        <form action="javascript:void(0)" method="post">
            <h3>用户名</h3>
            <label>
                <input autocomplete="off" autofocus  name="userName" placeholder="" required type="text">
            </label>
            <h3>邮箱</h3>
            <label>
                <input autocomplete="off"  name="userEmail" placeholder="" required type="email">
            </label>
            <h3>密码</h3>
            <label>
                <input autocomplete="new-password" id="userPassword" name="userPassword" required type="password">
            </label>
            <h3>确认密码</h3>
            <label>
                <input autocomplete="new-password" id="reUserPassword" required type="password">
            </label>
            <button class="register1" name="mode" value="register">注册</button>
        </form>
    </div>

</div>
<script src="js/crypto-js.js">
    </script>
<script type="module">
    // import CryptoJS from './js/crypto-js.js';
    
    //切换登陆注册的按键
    var modeBtu = document.getElementById('mode');
    //登录表单
    var loginForm = document.getElementsByClassName('main')[0];
    //注册表单
    var registerForm = document.getElementsByClassName('main')[1];
    //切换登陆注册功能
    modeBtu.onclick=function(){
        // 点击循环切换登陆注册
        if(modeBtu.textContent==='注册'){
            modeBtu.innerHTML='登陆';
            loginForm.style.display='none';
            registerForm.style.display='block';
        }else{
            modeBtu.innerHTML='注册';
            loginForm.style.display='block';
            registerForm.style.display='none';
        }
    }
    // 获得地址栏的mode参数，方便判定要转入的界面模式
    var mode = window.location.href.split('=')[1];
    //如果申请的路径是注册界面，则显示注册界面，因为默认是登陆界面，所以需要判断
    if(mode==='register'){
        modeBtu.click();
    }
    //登录键
    var login = document.getElementsByClassName('login1')[0];
    login.onclick = function () {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', "/LeoBlog/login");
        var formData = new FormData();
        formData.set("userPassword", document.getElementsByName('userPassword')[0].value);
        formData.set("userName", document.getElementsByName('userName')[0].value);
        xhr.send(formData);
        var rememberMe = document.getElementsByName('rememberMe')[0];
        if (rememberMe.checked){
            
        //
        //     var userName = document.getElementsByName('userName')[0].value;
        //     var userPassword = document.getElementsByName('userPassword')[0].value;
        //
        //
        //     var aseKey = CryptoJS.MD5("12345678").toString().substr(0,8);
        //     //加密
        //     var uname = CryptoJS.AES.encrypt(userName, CryptoJS.enc.Utf8.parse(aseKey), {
        //         mode: CryptoJS.mode.ECB,
        //         padding: CryptoJS.pad.Pkcs7
        //     }).toString();
        //     var upwd = CryptoJS.AES.encrypt(userPassword, CryptoJS.enc.Utf8.parse(aseKey), {
        //         mode: CryptoJS.mode.ECB,
        //         padding: CryptoJS.pad.Pkcs7
        //     }).toString();
        //     var unameStr = CryptoJS.AES.encrypt("userName", CryptoJS.enc.Utf8.parse(aseKey), {
        //         mode: CryptoJS.mode.ECB,
        //         padding: CryptoJS.pad.Pkcs7
        //     }).toString();
        //     var upwdStr = CryptoJS.AES.encrypt("userPassword", CryptoJS.enc.Utf8.parse(aseKey), {
        //         mode: CryptoJS.mode.ECB,
        //         padding: CryptoJS.pad.Pkcs7
        //     }).toString();
        //     document.cookie = unameStr+"="+uname+";path=/;expires="+new Date(new Date().getTime()+2*60*60*1000).toGMTString();
        //     document.cookie = upwdStr+"="+upwd+";path=/;expires="+new Date(new Date().getTime()+2*60*60*1000).toGMTString();
        }
        xhr.onreadystatechange = function () {
            var result = xhr.responseText;
            result = JSON.parse(result);
            var code = result.code;
            var msg = result.msg;
            if (code === 200) {

                window.location.href = "/LeoBlog/ToIndex";
            } else {
                Swal.fire({
                    title: msg,
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                })
            }
        }
    }
    //注册键
    var register = document.getElementsByClassName('register1')[0];
    register.onclick = function () {
        var userPassword = document.getElementById("userPassword").value;
        var reUserPassword = document.getElementById("reUserPassword").value;
        if (userPassword !== reUserPassword) {
            Swal.fire({
                title: '两次密码不一致',
                text: '请重新输入密码',
                icon: 'error',
                showCancelButton: false,
                confirmButtonText: 'OK'
            })
            return;
        }
        var xhr = new XMLHttpRequest();
        xhr.open('POST', "/LeoBlog/register");
        var formData = new FormData();
        formData.set("userPassword", document.getElementsByName("userPassword")[1].value);
        formData.set("userName", document.getElementsByName("userName")[1].value);
        formData.set("userEmail", document.getElementsByName("userEmail")[0].value);
        xhr.send(formData);
        xhr.onreadystatechange = function () {
            var result = xhr.responseText;
            result = JSON.parse(result);
            var code = result.code;
            var msg = result.msg;
            if (code === 200) {
                Swal.fire({
                    title: msg,
                    text: '点击确认键去登陆',
                    icon: 'success',
                    showCancelButton: false,
                    confirmButtonText: 'OK',
                }).then((result) => {
                    if (result.value) {
                        modeBtu.click();
                    }
                })
            } else {
                Swal.fire({
                    title: msg,
                    icon: 'error',
                    showCancelButton: false,
                    confirmButtonText: 'OK'
                })
            }
        }
    }
</script>
</body>
</html>